###
# Example Environment Variables, REMOVE .example extension before use and fill in values
###

# Discord Bot
BOT_TOKEN="discord_bot_token"
BOT_API_URL="http://localhost:8000"

# Logging (Bot / Worker)
LOG_LEVEL="INFO"                 # Logging level: DEBUG, VERBOSE, INFO, WARNING, ERROR, CRITICAL (default: INFO)

# Database
DB_HOST="dcs-postgres" # should match name of postgres container
DB_PORT=5432
DB_TYPE="postgres" # only postgres is supported
DB_USER="postgres"
DB_PASSWORD="postgres"
DB_NAME="postgres"

# Database Connection Pool Settings (per worker process)
# Total DB connections = (num_workers Ã— DB_POOL_MAX)
# Ensure PostgreSQL max_connections > total connections
# Default PostgreSQL max_connections is usually 100
DB_POOL_MIN=2              # Minimum connections per worker (default: 2)
DB_POOL_MAX=10             # Maximum connections per worker (default: 10)
DB_MAX_QUERIES=50000       # Max queries before connection recycling (default: 50000)
DB_MAX_IDLE_TIME=300       # Max idle time in seconds (default: 300 = 5 minutes)

# Discord OAuth for Next.js
DISCORD_CLIENT_ID="12345"
DISCORD_CLIENT_SECRET="ABC123"

# Discord Invite Link Generation Utilities
DISCORD_BOT_SCOPE="guilds bot applications.commands identify" # these are the required scopes
DISCORD_BOT_PERMISSIONS="65536" # The permissions integer from oauth bot section

# NextAuth.js
NEXTAUTH_SECRET="changeme"
NEXTAUTH_URL="http://localhost:3000"

# Settings YAML file path inside the container. Must be a FILE path, not a directory.
# The Dockerfile bakes the default into /app/settings.default.yml
DEFAULT_SETTINGS_PATH="/app/settings.default.jsonc"

# Redis
REDIS_URL="redis://dcs-redis:6379"
REDIS_STREAM_MAXLEN=10000            # Max jobs in stream (default: 10000, ~20MB memory for 10k jobs)

# Worker Settings
STORAGE_TYPE="local"
STORAGE_PATH="/app/storage"
WORKER_JOB_BATCH_SIZE=10             # Number of jobs to read per batch (default: 10, reduces Redis calls)

# Settings Cache (eliminates repeated DB queries for channel settings)
SETTINGS_CACHE_TTL_SECONDS=300       # Cache TTL in seconds (default: 300 = 5 minutes)

# Database Retry Logic (handles transient connection errors)
DB_RETRY_MAX_ATTEMPTS=3              # Max retry attempts for DB operations (default: 3)
DB_RETRY_BASE_DELAY=0.5              # Initial retry delay in seconds (default: 0.5)
DB_RETRY_MAX_DELAY=10.0              # Maximum retry delay cap in seconds (default: 10.0)

# Database Health Checks (periodic connection monitoring)
DB_HEALTH_CHECK_INTERVAL=60          # Health check interval in seconds (default: 60)

# Video Download Timeouts (prevents workers hanging on stalled downloads)
VIDEO_DOWNLOAD_TIMEOUT=300           # Total download timeout in seconds (default: 300 = 5 minutes)
VIDEO_DOWNLOAD_CONNECT_TIMEOUT=10    # Connection timeout in seconds (default: 10)

# Thumbnail dimensions
THUMBNAIL_SMALL_WIDTH=320      # Default: 320px
THUMBNAIL_SMALL_HEIGHT=180     # Default: 180px
THUMBNAIL_LARGE_WIDTH=640      # Default: 640px
THUMBNAIL_LARGE_HEIGHT=360     # Default: 360px

# Frame extraction
THUMBNAIL_TIMESTAMP=1.0        # Default: 1.0 seconds into video

# WebP quality
THUMBNAIL_QUALITY=85           # Default: 85 (0-100)

# Purge Settings
PURGE_COOLDOWN_MINUTES=5       # Cooldown between channel purges in minutes (default: 5, set to 0 to disable)